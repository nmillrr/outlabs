# Progress Log

## Learnings
(Patterns discovered during implementation)
- Use `python -m pytest` instead of `pytest` directly on Windows to avoid PATH issues
- Numpy arrays can be passed through the conversion functions for vectorized operations

---

## Iteration 1 - US-002: Implement Unit Conversion Utilities
- **What was implemented:**
  - `mg_dl_to_mmol_l()` - glucose mg/dL to mmol/L conversion
  - `mmol_l_to_mg_dl()` - glucose mmol/L to mg/dL conversion
  - `percent_to_mmol_mol()` - HbA1c NGSP (%) to IFCC (mmol/mol) conversion
  - `mmol_mol_to_percent()` - HbA1c IFCC (mmol/mol) to NGSP (%) conversion
- **Files changed:**
  - `hba1cE/utils.py` - Added all four conversion functions with docstrings
  - `tests/test_utils.py` - Created with 15 comprehensive tests
- **Learnings for future iterations:**
  - Conversion factors: glucose ÷18.018, HbA1c uses (NGSP - 2.15) × 10.929
  - Functions support both scalar and numpy array inputs
  - Clinical thresholds: 126 mg/dL ≈ 7.0 mmol/L, 6.5% HbA1c ≈ 48 mmol/mol
---

## Iteration 2 - US-003: Create NHANES Glycemic Download Module
- **What was implemented:**
  - `download_nhanes_glycemic(output_dir, cycles)` function in `hba1cE/data.py`
  - Complete file mappings for all NHANES cycles 2011-2018 (GHB, GLU, TRIGLY, HDL, CBC, DEMO)
  - Automatic `data/raw/` directory creation with Path.mkdir(parents=True)
  - Graceful error handling for URLError, HTTPError, and OSError
  - Skip existing files to avoid re-downloading
- **Files changed:**
  - `hba1cE/data.py` - Added download function with ~120 lines of implementation
- **Learnings for future iterations:**
  - NHANES file naming convention: `{DATA_TYPE}_{CYCLE_LETTER}.XPT` (e.g., GHB_J.XPT for 2017-2018)
  - NHANES base URL: https://wwwn.cdc.gov/Nchs/Nhanes/{cycle}/{filename}
  - Cycles use letter suffixes: G=2011-12, H=2013-14, I=2015-16, J=2017-18
---

